@model IEnumerable<ManvarFitness.Entity.HerbCategory>
<style>
    /* OFF state */
    .form-check-input {
        background-color: #ccc; /* gray when OFF */
        border-radius: 1rem; /* keep default Bootstrap rounded */
        transition: background-color 0.4s;
    }

        /* ON state */
        .form-check-input:checked {
            background-color: #FF7F11; /* orange when ON */
        }
</style>
@{
    ViewData["Title"] = "Manage Categories";
}

<h2 class="fw-semibold mb-3"
    style="display: inline-block; color: #333; padding-bottom: 4px; border-bottom: 3px solid #FF7F11; border-radius: 2px;">
    Manage Categories
</h2><br />


<a class="btn btn-primary mb-3" asp-controller="HerbsCategory" asp-action="Create">Add Category</a>

<table class="table table-bordered table-hover align-middle">
    <thead class="table-light">
        <tr>
            <th style="width:80%">Category</th>
            <th style="width:10%">Status</th>
            <th style="width:10%">Action</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var category in Model)
        {
            <tr>
                <td>@category.Name</td>
                <td>
                    <div class="form-check form-switch text-center">
                        <input class="form-check-input toggle-status"
                               type="checkbox"
                               data-categoryid="@category.Id"
                               id="switchCategory@category.Id"
                               @(category.IsActive ? "checked" : "") />
                        <label class="form-check-label" for="switchCategory@category.Id"></label>
                    </div>
                </td>
                <td class="text-center">
                    <button type="button"
                            class="btn btn-sm text-warning me-1"
                            data-bs-toggle="modal"
                            data-bs-target="#deleteModal"
                            onclick="setDeleteId(@category.Id)">
                        <i class="bi bi-trash-fill fs-5"></i>
                    </button>
                </td>
            </tr>
        }
    </tbody>
</table>

<!-- Delete Modal -->
<div class="modal fade" id="deleteModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content border-0 shadow-sm">
            <div class="modal-header bg-light">
                <h5 class="modal-title">Confirm Delete</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                Are you sure you want to delete this category?
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-danger" onclick="deleteCategory()">Delete</button>
            </div>
        </div>
    </div>
</div>

@Html.AntiForgeryToken()
<script>
    let selectedCategoryId = 0;

    // Set Delete ID
    function setDeleteId(id) {
        selectedCategoryId = id;
    }

    // Delete Category (Soft Delete)
    function deleteCategory() {

        if (selectedCategoryId === 0) {
            alert("Invalid category.");
            return;
        }

        fetch(`/HerbsCategory/SoftDelete?id=${selectedCategoryId}`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'RequestVerificationToken': document.querySelector('input[name="__RequestVerificationToken"]').value
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                location.reload();
            } else {
                alert("Delete failed.");
            }
        })
        .catch(error => {
            console.error("Delete Error:", error);
            alert("Something went wrong.");
        });
    }

    // Toggle Status
    document.addEventListener("DOMContentLoaded", function () {

        document.querySelectorAll(".toggle-status").forEach(toggle => {

            toggle.addEventListener("change", function () {

                const categoryId = this.dataset.categoryid;
                const checkbox = this;

                fetch(`/HerbsCategory/ToggleStatus/${categoryId}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'RequestVerificationToken': document.querySelector('input[name="__RequestVerificationToken"]').value
                    }
                })
                .then(response => response.json())
                .then(data => {

                    if (!data.success) {
                        alert("Failed to update status.");
                        checkbox.checked = !checkbox.checked;
                    }

                })
                .catch(error => {
                    console.error("Toggle Error:", error);
                    checkbox.checked = !checkbox.checked;
                });

            });

        });

    });
</script>


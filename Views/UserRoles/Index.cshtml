@model IEnumerable<ManvarFitness.Entity.Role>
<style>
    /* OFF state */
    .form-check-input {
        background-color: #ccc; /* gray when OFF */
        border-radius: 1rem; /* keep default Bootstrap rounded */
        transition: background-color 0.4s;
    }

        /* ON state */
        .form-check-input:checked {
            background-color: #FF7F11; /* orange when ON */
        }
</style>
<h2 class="fw-semibold mb-0"
    style="display: inline-block; color: #333; padding-bottom: 4px; border-bottom: 3px solid #FF7F11; border-radius: 2px;">
    Manage User Roles
</h2>
<br />
<br />

<a class="btn btn-primary mb-3" asp-controller="UserRoles" asp-action="Create">Add Role</a>
@Html.AntiForgeryToken()
<table class="table table-bordered">
    <thead>
        <tr>
            <th style="width:80%">Role</th>
            <th>Status</th>
            <th>Action</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var role in Model)
        {
            <tr>
                <td>@role.Name</td>
                <td>
                    <div class="form-check form-switch m-0">
                        <input class="form-check-input"
                               type="checkbox"
                               role="switch"
                               data-roleid="@role.Id"
                               id="switchRole@role.Id"
                               @(role.IsActive ? "checked" : "") />
                        <label class="form-check-label" for="switchRole@role.Id"></label>
                    </div>
                </td>
                <td>
                    <div class="action-buttons">

                        <button type="button"
                                class="btn btn-sm"
                                style="color:#FF7F11;"
                                data-bs-toggle="modal"
                                data-bs-target="#deleteModal"
                                onclick="setDeleteId(@role.Id)">
                            <i class="bi bi-trash-fill fs-5"></i>
                        </button>
                    </div>
                </td>
            </tr>
        }
    </tbody>
</table>
<div class="modal fade" id="deleteModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Confirm Deletion</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                Are you sure you want to delete?
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    Cancel
                </button>
                <button type="button" class="btn btn-danger" onclick="deleteRole()">
                    Delete
                </button>
            </div>
        </div>
    </div>
</div>

<script>
    var selectedRoleId = 0;

    function setDeleteId(id) {
        selectedRoleId = id;
    }

    function deleteRole() {

        var token = document.querySelector('input[name="__RequestVerificationToken"]').value;

        fetch('/UserRoles/SoftDelete', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
                'RequestVerificationToken': token
            },
            body: 'id=' + selectedRoleId
        })
        .then(res => res.json())
        .then(data => {
            if (data.success) {
                location.reload();
            } else {
                alert("Delete failed");
            }
        })
        .catch(error => {
            console.error(error);
            alert("Error occurred");
        });
    }
</script>

